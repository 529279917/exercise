====================================
路由器练习题4 - 路由器,网络，子网区别联系
====================================

1. 查看虚机IP地址
===============

    nova list

2. 查看路由对应的网卡地址
======================

    neutron router-port-list router2

3. 登录路由器namespace
=====================

新开一个窗口，参考4.1登录路由器namespace

4. 登录vm1，vm2
==============

参考4.3，新开两个窗口，分别登录vm1和vm2

5. 从vm1 ping 8.8.8.8
=====================

在vm1的窗口，执行

    ping 8.8.8.8

6. 检查路由器内网络包的变化
========================

回到步骤3窗口，

    tcpdump -nei <11.0.0.1对应的网卡>

注意ICMP报文的源地址是vm1的地址

    tcpdump -nei <172.24.4.0/24对应的网卡>

注意ICMP报文的源地址对应的是router gateway的地址，请大家分析这里的NAT机制。

7. 从vm2 ping 8.8.8.8
=====================

在vm2窗口，执行

    ping 8.8.8.8

8. 检查路由器内网络包的变化
========================

回到步骤6窗口

    tcpdump -nei <172.24.4.0/24对应的网卡>

注意ICMP报文的源地址对应的是router gateway的地址，请大家检查这里与步骤6所观察到的ICMP id是不一样的，并分析原因。

9. 查找vm1对应的port
===================

命令
----
    neutron port-list --device-id <vm1 uuid>

记录port uuid

10. 创建floatingip
====================

命令
----

    neutron floatingip-create public --port-id <步骤9中的port uuid>

11. 从vm1 ping 8.8.8.8
======================

在vm1的窗口，执行

    ping 8.8.8.8

12. 检查路由器内网络包的变化
========================

回到步骤8窗口

    tcpdump -nei <172.24.4.0/24对应的网卡>

注意ICMP报文的源地址对应的是floatingip的地址

13. 从操作系统ping floatingip
============================

回到步骤10窗口，ping 步骤10中创建出来的floatingip地址。

查看ping的返回，ping能成功。

14. 查看进入虚机的网络包
=====================

回到步骤12窗口

    tcpdump -nei <11.0.0.1对应的网卡>

查看ICMP报文，确认发往虚机的ICMP报文的目的IP地址是虚机的IP地址。

15. 解除floatingip关联
=====================

回到步骤13窗口

命令
----

    neutron floatingip-disassociate <步骤10中floatingip uuid>

16. 验证floatingip不能访问
========================

ping floatingip地址，发现ping返回失败。